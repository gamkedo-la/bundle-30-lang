<html>

<canvas id = 'circularMovementCanvas' width = '640' height = '700'></canvas>
<image id = 'fanBladesImage' src = 'fanBlades.png'></image>

<script>

  let circularMovementCanvas;
  let circularMovementCanvasContext;

  function getRandomIntInclusive(min, max)
  {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min + 1)) + min; //The maximum is inclusive and the minimum is inclusive
  }



  let arrayOfFanBlades = [];
  let fanBlade1;
  let fanBlade2;

  let BladePrototype = function(xStartingImagePoint,yStartingImagePoint, rotationDirection)
  {
    this.width = 50;
    this.height = 20;

    this.xStartingImagePoint = xStartingImagePoint;
    this.yStartingImagePoint = yStartingImagePoint;

    this.xCenterImagePoint = this.xStartingImagePoint + this.width/2;
    this.yCenterImagePoint = this.yStartingImagePoint + this.height/2;

    this.angle = 0;
    this.rotationSpeed = 20;
    this.rotationDirection = rotationDirection;

    this.updateAngle = function()
    {
      this.angle += this.rotationSpeed;
    }

    this.draw = function()
    {
      circularMovementCanvasContext.save();
      circularMovementCanvasContext.translate(this.xCenterImagePoint,this.yCenterImagePoint);
      circularMovementCanvasContext.rotate(Math.PI / 180 * (this.angle*this.rotationDirection));
      circularMovementCanvasContext.drawImage(fanBladesImage, this.xCenterImagePoint - this.width/2,
                                              this.yCenterImagePoint - this.height/2, this.width,this.height);

      circularMovementCanvasContext.restore();
      circularMovementCanvasContext.drawImage(fanBladesImage, 0,0, 640,700);
      // circularMovementCanvasContext.fillStyle = 'blue';
      // circularMovementCanvasContext.fillRect(0,0, 640,700);
    }
  }

  let LetterPrototype = function(nameString)
  {
    this.name = nameString;
    this.x = getRandomIntInclusive(100,430);
    this.y = getRandomIntInclusive(100,590);
    this.fontSize = 50;

    this.circlePathVelocity = 0.25;
    this.xVelocity = 5;
    this.yVelocity = 5;

    this.draw = function()
    {
      circularMovementCanvasContext.fillStyle = 'blue';
      circularMovementCanvasContext.font = '30px Helvetica';
      circularMovementCanvasContext.fillText(this.name, this.x,this.y);
    }

    //actual circle motion stuff
    this.radius = this.width/2;//not really a radius, taken from code that animated a circle
    this.radians = 0;


    this.updatePosition = function()
    {
      //move points over time
      this.radians += this.circlePathVelocity;
      this.x = this.x + (Math.cos(this.radians) * 10) + this.xVelocity;
      this.y = this.y + (Math.sin(this.radians) * 10) + this.yVelocity;
    }

    this.checkWallCollision = function()
    {
      if (this.x + 100 > 630 || this.x  - 100 < 10)
      {
        this.xVelocity *= -1;
      }
      if (this.y + 100 > 690 || this.y - 100 < 10)
      {
        this.yVelocity *= -1;
      }
    }
  };

  let letterM;
  let letterN;

  let fanBladesImage;

  window.onload = function()
  {
    circularMovementCanvas = document.getElementById("circularMovementCanvas");
    circularMovementCanvasContext = circularMovementCanvas.getContext('2d');

    letterM = new LetterPrototype('m');
    letterN = new LetterPrototype('n');

    // let blade1CenterPoint = {x:340, y:570};
    // let blade2CenterPoint = {x:375, y:570};
    fanBlade1 = new BladePrototype(315,560, -1);
    fanBlade2 = new BladePrototype(350,560, 1);
    arrayOfFanBlades.push(fanBlade1);
    arrayOfFanBlades.push(fanBlade2);

    fanBladesImage = document.getElementById('fanBladesImage');

    setInterval(animationLoop, 1000/30);
    setInterval(changeLetterMXVelocity, 500);
    setInterval(changeLetterNYVelocity, 500);
  }

  function animationLoop()
  {
    updatePositions();
    drawEverything();
  }

  function updatePositions()
  {
    letterM.updatePosition();
    letterM.checkWallCollision();
    letterN.updatePosition();
    letterN.checkWallCollision();

    updateFanBladeAngles();
  }

  function drawEverything()
  {
      drawBackground();
      drawFan();
      letterM.draw();
      letterN.draw();
  }

  function drawBackground()
  {
    circularMovementCanvasContext.fillStyle = 'black';
    circularMovementCanvasContext.fillRect(0,0, 640,700);
  }

  let arrayOfPossibleXYVelocityIntegers = [-30,-15,-10,-9,8,9,10,15,30];

  function changeLetterMXVelocity()
  {
    let randomIndexForArrayOfPossibleIntegers = getRandomIntInclusive(0, arrayOfPossibleXYVelocityIntegers.length - 1);
    letterM.xVelocity = arrayOfPossibleXYVelocityIntegers[randomIndexForArrayOfPossibleIntegers];

  }

  function changeLetterMYVelocity()
  {
    let randomIndexForArrayOfPossibleIntegers = getRandomIntInclusive(0, arrayOfPossibleXYVelocityIntegers.length - 1);
    letterM.yVelocity = arrayOfPossibleXYVelocityIntegers[randomIndexForArrayOfPossibleIntegers];

  }

  function changeLetterNXVelocity()
  {
    let randomIndexForArrayOfPossibleIntegers = getRandomIntInclusive(0, arrayOfPossibleXYVelocityIntegers.length - 1);
    letterN.xVelocity = arrayOfPossibleXYVelocityIntegers[randomIndexForArrayOfPossibleIntegers];

  }

  function changeLetterNYVelocity()
  {
    let randomIndexForArrayOfPossibleIntegers = getRandomIntInclusive(0, arrayOfPossibleXYVelocityIntegers.length - 1);
    letterN.yVelocity = arrayOfPossibleXYVelocityIntegers[randomIndexForArrayOfPossibleIntegers];

  }

  function randomizeTimeLengthForSetIntervalReset(minTimeInteger,maxTimeInteger)
  {
    let randomTimeLengthToResetValue = getRandomIntInclusive(minTimeInteger,maxTimeInteger);

    return randomTimeLengthToResetValue;
  }

  let letterMCircleVelocityInterval;
  let letterMXVelocityInterval;
  let letterMYVelocityInterval;
  let letterNCircleVelocityInterval;
  let letterNXVelocityInterval;
  let letterNYVelocityInterval;

  function frameInterval(updateFunction, frameRate) {
      var timerObject = setInterval(updateFunction, frameRate);

      this.stop = function() {
          if (timerObject) {
              clearInterval(timerObject);
              timerObject = null;
          }
          return this;
      }

      // start timer using current settings (if it's not already running)
      this.start = function() {
          if (!timerObject) {
              this.stop();
              timerObject = setInterval(updateFunction, frameRate);
          }
          return this;
      }

      // start with new interval, stop current interval
      this.reset = function(newRate) {
          frameRate = newRate;
          return this.stop().start();
      }
  }



  function drawFan()
  {
    //box
    circularMovementCanvasContext.fillStyle = 'white';
    circularMovementCanvasContext.fillRect(320,550, 75,150);

    //blades
    for (let fanBladesIndex = 0; fanBladesIndex < arrayOfFanBlades.length; fanBladesIndex++)
    {
      arrayOfFanBlades[fanBladesIndex].draw();
    }
  }

  function updateFanBladeAngles()
  {
    for (let fanBladesIndex = 0; fanBladesIndex < arrayOfFanBlades.length; fanBladesIndex++)
    {
      arrayOfFanBlades[fanBladesIndex].updateAngle();
    }
  }

</script>

</html>
